/* built */!function(){"use strict";var c;function n(){c.countdown.classList.remove("visible"),c.els.page.classList.add("gameplay"),1!=c.status&&(c.status=1,l(),b("initialCreatures",s,50,10),c.timing.start=Date.now(),setTimeout(a,c.timing.init))}function a(){var e,t,n;1==c.status&&(e=Date.now()-c.timing.start,t=function(e,t,n){var a,s;return a=Math.abs(t)-Math.abs(e),s=(Math.abs(n)-Math.abs(e))/a,Math.pow(s,2)}(0,c.timing.duration,e),n=Math.max(120,Math.min(300,c.container.x*c.container.y/1e6*300)),c.timing.interval=Math.max(n,c.timing.init-c.timing.init*t),s(),c.n++,setTimeout(a,c.timing.interval))}function o(){window.clearInterval(c.timing.timers.endGame),c.els.page.classList.remove("gameplay"),c.score.board.parent.removeChild(c.score.board.wrapper),document.getElementById("main").removeChild(c.game)}function l(){var e,t;1==c.status&&(c.score.board.points.innerHTML=h(c.score.points),c.score.points>=c.score.high&&(c.score.board.high.innerHTML=h(c.score.points)),e=c.score.spawned-c.score.removed,t=100/c.pointcap*e,c.progress.style.width=t+"%",t<50?c.progress.classList.remove("alert"):t<75?(c.progress.classList.remove("warning"),c.progress.classList.add("alert")):t<90?(c.progress.classList.remove("alert","danger"),c.progress.classList.add("warning")):t<100&&(c.progress.classList.remove("warning"),c.progress.classList.add("danger")),c.pointcap==e&&function(){var e,t;for(e in c.status=2,c.endscreen.stats)t=0,null!=c.score.types[e]&&(t=c.score.types[e]),c.endscreen.stats[e].innerHTML=t;m(c.audio.end),c.container.el.classList.add("endgame"),c.endscreen.el.classList.add("visible"),c.score.points>v()&&(f(c.score.points),c.endscreen.el.classList.add("new-high")),b("endGame",s,20,Math.floor(Math.max(200,Math.min(600,c.container.x*c.container.y/1e6*400))))}())}function u(){var e,t,n,a={};switch(t=Math.floor(1e3*Math.random()),n=Math.floor(3*Math.random()+1),t<300?a.type=c.types.tunicate1.slug:t<600?a.type=c.types.tunicate2.slug:t<750?a.type=c.types.seaweed1.slug:t<900?a.type=c.types.seaweed2.slug:t<1e3&&(a.type=c.types.crab.slug),n){case 1:e="slow";break;case 2:e="fast";break;default:e=""}return a.div=document.createElement("div"),a.div.className="creature "+a.type+" "+e,a}function s(){var e,t,n,a,s,r,o,i,d;t=function(e){var t,n;return t=c.container.el.querySelectorAll("."+e+":not(.destroyed)"),n=Math.floor(Math.random()*t.length),0<t.length?t[n].parentNode.getAttribute("id"):null}((e=u()).type),d="c_"+Math.random().toString(36).substr(2,9),a={left:0,right:c.container.x-128,top:Math.max(128,c.container.y-16*c.n),bottom:c.container.y-c.score.board.h},o=(n=Math.floor(1e3*Math.random()))<700&&null!=t&&"crab"!=e.type&&0<c.n?(r=Math.min(a.right,Math.max(128,c.creatures[t].x+c.unit*Math.floor(17*Math.random()-8))),Math.min(a.bottom,Math.max(128,c.creatures[t].y+c.unit*Math.floor(17*Math.random()-8)))):(r=Math.max(a.left,c.unit*Math.floor(Math.random()*(a.right/c.unit))),Math.max(a.top,c.unit*Math.floor(Math.random()*(a.bottom/c.unit)))),i=Math.floor(10*Math.random()+1),(s=document.createElement("div")).id=d,s.className="creature-wrapper",n<500&&s.classList.add("flipped"),s.style="top:"+o+"px; left:"+r+"px; z-index:"+i,s.appendChild(e.div),1==c.status&&s.addEventListener("click",function(e){var t,n;switch((t=c.creatures[e]).el.classList.add("destroyed"),t.status=0,null==c.score.types[t.type]?c.score.types[t.type]=1:c.score.types[t.type]++,setTimeout(function(){c.container.el.removeChild(t.el)},5e3),t.type){case c.types.crab.slug:m(c.audio.elevate),n=30;break;case c.types.tunicate1.slug:m(c.audio.bounce),n=10;break;case c.types.tunicate2.slug:m(c.audio.bounce),n=30;break;case c.types.seaweed1.slug:case c.types.seaweed2.slug:m(c.audio.shoot),n=20;break;default:m(c.audio.shoot),n=10}c.score.removed++,c.score.points+=n,l()}.bind(null,d),!1),c.creatures[d]={el:s,x:r,y:o,type:e.type,status:1},c.container.el.appendChild(s),c.score.spawned++,l()}function r(){var e,t,n,a,s;e=Math.floor(7001*Math.random()+1e3),t="b_"+Math.random().toString(36).substr(2,9),n=c.unit*Math.floor(Math.random()*(c.container.x/c.unit)),a=c.unit*Math.floor(Math.random()*(c.container.y/c.unit)),(s=document.createElement("div")).id=t,s.className="bubbles bubbles-1",s.style="top:"+a+"px; left:"+n+"px",c.bubbles.appendChild(s),setTimeout(function(){c.bubbles.removeChild(s)},5e3),setTimeout(r,e)}function m(e){var t,n,a;n=i,a=d,c.audio.menu==e&&(n=function(){e.onended=p},a=p),e.paused?void 0!==(t=e.play())&&t.then(n).catch(a):e.currentTime=0}function i(){}function d(){}function p(){switch(c.status){case 0:n();break;case 1:c.status=3,c.timing.paused=Date.now(),c.container.el.classList.add("paused"),c.buttons.controls.classList.add("paused"),c.els.page.classList.remove("gameplay");break;case 2:window.clearInterval(c.timing.timers.endGame),c.container.el.innerHTML="",c.container.el.classList.remove("endgame"),c.endscreen.el.classList.remove("visible","new-high"),c.progress.className="",c.score.points=0,c.score.high=v(),c.score.spawned=0,c.score.removed=0,c.score.types={},c.n=0,c.score.board.high.innerHTML=h(c.score.high),n();break;case 3:!function(){var e=Date.now();c.status=1,c.timing.start+=e-c.timing.paused,c.container.el.classList.remove("paused"),c.buttons.controls.classList.remove("paused"),c.els.page.classList.add("gameplay"),setTimeout(a,c.timing.interval)}()}}function h(e){var t="00000"+e;return t.substr(t.length-5)}function t(){c.score.board.h=c.score.board.el.offsetHeight,c.score.board.y=c.score.board.el.getBoundingClientRect().top,c.container.el.style.height="calc( 100vh - "+c.score.board.h+"px)",c.container.x=c.container.el.offsetWidth,c.container.y=c.container.el.offsetHeight}function g(){window.pageYOffset>c.score.board.y-c.container.y&&0==c.status&&(c.score.board.el.classList.add("fixed"),function(){var e,t;c.status=4,e=4,c.countdown.classList.add("visible"),(t=function(){e--,0<(c.countdown.innerHTML=e)?setTimeout(t,1e3):n()})()}())}function b(e,t,n,a){var s;s=0,c.timing.timers[e]=window.setInterval(function(){t(),++s===a&&window.clearInterval(c.timing.timers[e])},n)}function v(){var e;return""==(e=function(e){var t,n,a,s;for(t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(s=n[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}("uri-space-invaders-high-score"))?(f(0),0):e}function f(e){!function(e,t,n){var a,s;(a=new Date).setTime(a.getTime()+24*n*60*60*1e3),s="expires="+a.toUTCString(),document.cookie=e+"="+t+";"+s+";path=/"}("uri-space-invaders-high-score",e,365)}window.addEventListener("load",function(){var e;e=URIMODERN.path.theme+"/features/2019/space-invaders/",(c={unit:16,status:0,pointcap:50,n:0,els:{page:document.getElementById("page"),habitat:document.getElementById("habitat-creatures")},story:{h:document.getElementById("story").offsetHeight,top:document.getElementById("story").getBoundingClientRect().top},buttons:{},creatures:{},types:{tunicate1:{slug:"tunicate-1",name:"Styela clava"},tunicate2:{slug:"tunicate-2",name:"Ciona intestinalis"},seaweed1:{slug:"seaweed-1",name:""},seaweed2:{slug:"seaweed-2",name:""},crab:{slug:"crab",name:"Hemigrapsus sanguineus"}},container:{},endscreen:{},score:{points:0,spawned:0,removed:0,types:{},high:v(),board:{wrapper:document.getElementById("scoreboard-wrapper")}},timing:{init:2e3,duration:6e4,timers:{}},audio:{bounce:new Audio(e+"mp3/bounce.mp3"),elevate:new Audio(e+"mp3/elevate.mp3"),shoot:new Audio(e+"mp3/shoot.mp3"),end:new Audio(e+"mp3/end.mp3"),menu:new Audio(e+"mp3/menu.mp3")}}).game=document.createElement("div"),c.game.id="game",c.game.appendChild(function(){var e,t,n,a,s,r;for(s in c.endscreen.el=document.createElement("div"),c.endscreen.el.id="endscreen",c.endscreen.el.className="modal",c.endscreen.el.innerHTML="<h1>Game <br> Over</h1>",(t=document.createElement("div")).id="new-high-score",t.innerHTML="New High Score",c.endscreen.el.appendChild(t),(e=document.createElement("div")).id="game-stats",c.endscreen.stats={},c.types)r=c.types[s].slug,(n=document.createElement("div")).className="stat-wrapper",(a=document.createElement("span")).className="stat-creature "+r,n.appendChild(a),c.endscreen.stats[r]=document.createElement("span"),c.endscreen.stats[r].className="stat-label",c.endscreen.stats[r].innerHTML=0,n.appendChild(c.endscreen.stats[r]),(a=document.createElement("span")).className="stat-creature-name",a.innerHTML=c.types[s].name,n.appendChild(a),e.appendChild(n);return c.endscreen.el.appendChild(e),c.buttons.reset=document.createElement("div"),c.buttons.reset.id="reset-game",c.buttons.reset.className="retro-button",c.buttons.reset.innerHTML="play again",c.endscreen.el.appendChild(c.buttons.reset),(n=document.createElement("div")).id="remove-game",n.innerHTML="or, just read the story",n.addEventListener("click",o,!1),c.endscreen.el.appendChild(n),c.endscreen.el}()),c.game.appendChild((c.countdown=document.createElement("div"),c.countdown.id="countdown",c.countdown.className="modal",c.countdown.innerHTML=3,c.countdown)),c.game.appendChild((c.container.el=document.createElement("div"),c.container.el.id="creature-container",c.container.el)),c.game.appendChild((c.bubbles=document.createElement("div"),c.bubbles.id="bubbles-container",c.bubbles)),c.score.board.wrapper.appendChild(function(){var e,t,n,a,s;return c.buttons.controls=document.createElement("div"),c.buttons.controls.id="controls",c.buttons.pause=document.createElement("div"),c.buttons.pause.id="pause-game",c.buttons.pause.innerHTML="pause",c.buttons.controls.appendChild(c.buttons.pause),c.buttons.resume=document.createElement("div"),c.buttons.resume.id="resume-game",c.buttons.resume.innerHTML="resume",c.buttons.controls.appendChild(c.buttons.resume),(e=document.createElement("div")).id="scores",(t=document.createElement("div")).id="points",t.innerHTML='<div class="label">score</div>',c.score.board.points=document.createElement("div"),c.score.board.points.className="score",c.score.board.points.innerHTML=h(c.score.points),t.appendChild(c.score.board.points),e.appendChild(t),(n=document.createElement("div")).id="high",n.innerHTML='<div class="label">high</div>',c.score.board.high=document.createElement("div"),c.score.board.high.className="score",c.score.board.high.innerHTML=h(c.score.high),n.appendChild(c.score.board.high),e.appendChild(n),(a=document.createElement("div")).id="progress",c.progress=document.createElement("div"),c.progress.id="progress-bar",a.appendChild(c.progress),(s=document.createElement("div")).id="progress-label",s.innerHTML="Complete Invasion! --\x3e",a.appendChild(s),c.score.board.el=document.createElement("div"),c.score.board.el.id="scoreboard",c.score.board.el.appendChild(c.buttons.controls),c.score.board.el.appendChild(e),c.score.board.el.appendChild(a),c.score.board.el}()),document.getElementById("main").appendChild(c.game),c.score.board.h=c.score.board.el.offsetHeight,c.score.board.y=c.score.board.el.getBoundingClientRect().top,c.score.board.parent=c.score.board.wrapper.parentElement,c.container.el.style.height="calc( 100vh - "+c.score.board.h+"px)",c.container.x=c.container.el.offsetWidth,c.container.y=c.container.el.offsetHeight,c.buttons.reset.addEventListener("click",function(){m(c.audio.menu)},!1),c.buttons.pause.addEventListener("click",function(){1==c.status&&m(c.audio.menu)},!1),c.buttons.resume.addEventListener("click",function(){3==c.status&&m(c.audio.menu)},!1),function(){var e,t,n,a;c.els.habitat.innerHTML="",e=document.createElement("div"),c.els.habitat.appendChild(e),b("populateCreatureBox",function(){t=u(),n=c.unit*Math.floor(48*Math.random()+1),a=Math.floor(10*Math.random()+1),t.div.style="left:"+n+"px; z-index:"+a,e.appendChild(t.div)},50,15)}(),r(),window.addEventListener("resize",t,!1),window.addEventListener("scroll",g,!1)},!1)}();
/* built */!function(){"use strict";let e;function t(){return e.container.el=document.createElement("div"),e.container.el.id="creature-container",e.container.el}function n(){return e.bubbles=document.createElement("div"),e.bubbles.id="bubbles-container",e.bubbles}function s(){e.countdown.classList.remove("visible"),e.els.page.classList.add("gameplay"),1!==e.status&&(e.status=1,r(),v("initialCreatures",c,50,10),e.timing.start=Date.now(),setTimeout(a,e.timing.init))}function a(){let t,n,s;1===e.status&&(t=Date.now()-e.timing.start,n=function(e,t,n){const s=Math.abs(t)-Math.abs(e),a=(Math.abs(n)-Math.abs(e))/s;return Math.pow(a,2)}(0,e.timing.duration,t),s=Math.max(120,Math.min(300,e.container.x*e.container.y/1e6*300)),e.timing.interval=Math.max(s,e.timing.init-e.timing.init*n),c(),e.n++,setTimeout(a,e.timing.interval))}function o(){window.clearInterval(e.timing.timers.endGame),e.els.page.classList.remove("gameplay"),e.score.board.parent.removeChild(e.score.board.wrapper),document.getElementById("main").removeChild(e.game),document.body.classList.remove("si-gameplay-supported")}function r(){let t,n;1===e.status&&(e.score.board.points.innerHTML=g(e.score.points),e.score.points>=e.score.high&&(e.score.board.high.innerHTML=g(e.score.points)),t=e.score.spawned-e.score.removed,n=100/e.pointcap*t,e.progress.style.width=n+"%",50>n?e.progress.classList.remove("alert"):75>n?(e.progress.classList.remove("warning"),e.progress.classList.add("alert")):90>n?(e.progress.classList.remove("alert","danger"),e.progress.classList.add("warning")):100>n&&(e.progress.classList.remove("warning"),e.progress.classList.add("danger")),e.pointcap===t&&function(){let t,n;for(t in e.status=2,e.endscreen.stats)n=0,null!==e.score.types[t]&&(n=e.score.types[t]),e.endscreen.stats[t].innerHTML=n;u(e.audio.end),e.container.el.classList.add("endgame"),e.endscreen.el.classList.add("visible"),e.score.points>y()&&(M(e.score.points),e.endscreen.el.classList.add("new-high")),v("endGame",c,20,Math.floor(Math.max(200,Math.min(600,e.container.x*e.container.y/1e6*400))))}())}function i(){let t;const n=Math.floor(1e3*Math.random()),s=Math.floor(3*Math.random()+1),a={};switch(300>n?a.type=e.types.tunicate1.slug:600>n?a.type=e.types.tunicate2.slug:750>n?a.type=e.types.seaweed1.slug:900>n?a.type=e.types.seaweed2.slug:1e3>n&&(a.type=e.types.crab.slug),s){case 1:t="slow";break;case 2:t="fast";break;default:t=""}return a.div=document.createElement("div"),a.div.className="creature "+a.type+" "+t,a}function c(){let t,n;const s=i(),a=function(t){const n=e.container.el.querySelectorAll("."+t+":not(.destroyed)"),s=Math.floor(Math.random()*n.length);return n.length>0?n[s].parentNode.getAttribute("id"):null}(s.type),o="c_"+Math.random().toString(36).substr(2,9),c={left:0,right:e.container.x-128,top:Math.max(128,e.container.y-16*e.n),bottom:e.container.y-e.score.board.h},l=Math.floor(1e3*Math.random());700>l&&null!==a&&"crab"!==s.type&&0<e.n?(t=Math.min(c.right,Math.max(128,e.creatures[a].x+e.unit*Math.floor(17*Math.random()-8))),n=Math.min(c.bottom,Math.max(128,e.creatures[a].y+e.unit*Math.floor(17*Math.random()-8)))):(t=Math.max(c.left,e.unit*Math.floor(Math.random()*(c.right/e.unit))),n=Math.max(c.top,e.unit*Math.floor(Math.random()*(c.bottom/e.unit))));const u=Math.floor(10*Math.random()+1),m=document.createElement("div");m.id=o,m.className="creature-wrapper",500>l&&m.classList.add("flipped"),m.setAttribute("style","top:"+n+"px; left:"+t+"px; z-index:"+u),m.appendChild(s.div),1===e.status&&m.addEventListener("click",d.bind(null,o),!1),e.creatures[o]={el:m,x:t,y:n,type:s.type,status:1},e.container.el.appendChild(m),e.score.spawned++,r()}function d(t){let n;const s=e.creatures[t];switch(s.el.classList.add("destroyed"),s.status=0,null===e.score.types[s.type]?e.score.types[s.type]=1:e.score.types[s.type]++,setTimeout((function(){e.container.el.removeChild(s.el)}),5e3),s.type){case e.types.crab.slug:u(e.audio.elevate),n=30;break;case e.types.tunicate1.slug:u(e.audio.bounce),n=10;break;case e.types.tunicate2.slug:u(e.audio.bounce),n=30;break;case e.types.seaweed1.slug:case e.types.seaweed2.slug:u(e.audio.shoot),n=20;break;default:u(e.audio.shoot),n=10}e.score.removed++,e.score.points+=n,r()}function l(){const t=Math.floor(7001*Math.random()+1e3),n="b_"+Math.random().toString(36).substr(2,9),s=e.unit*Math.floor(Math.random()*(e.container.x/e.unit)),a=e.unit*Math.floor(Math.random()*(e.container.y/e.unit)),o=document.createElement("div");o.id=n,o.className="bubbles bubbles-1",o.setAttribute("style","top:"+a+"px; left:"+s+"px"),e.bubbles.appendChild(o),setTimeout((function(){e.bubbles.removeChild(o)}),5e3),setTimeout(l,t)}function u(t){let n,s,a;s=m,a=p,e.audio.menu===t&&(s=function(){t.onended=h},a=h),t.paused?(n=t.play(),void 0!==n&&n.then(s).catch(a)):t.currentTime=0}function m(){}function p(){}function h(){switch(e.status){case 0:s();break;case 1:e.status=3,e.timing.paused=Date.now(),e.container.el.classList.add("paused"),e.buttons.controls.classList.add("paused"),e.els.page.classList.remove("gameplay");break;case 2:window.clearInterval(e.timing.timers.endGame),e.container.el.innerHTML="",e.container.el.classList.remove("endgame"),e.endscreen.el.classList.remove("visible","new-high"),e.progress.className="",e.score.points=0,e.score.high=y(),e.score.spawned=0,e.score.removed=0,e.score.types={},e.n=0,e.score.board.high.innerHTML=g(e.score.high),s();break;case 3:!function(){const t=Date.now();e.status=1,e.timing.start+=t-e.timing.paused,e.container.el.classList.remove("paused"),e.buttons.controls.classList.remove("paused"),e.els.page.classList.add("gameplay"),setTimeout(a,e.timing.interval)}()}}function g(e){const t="00000"+e;return t.substr(t.length-5)}function b(){e.score.board.h=e.score.board.el.offsetHeight,e.score.board.y=e.score.board.el.getBoundingClientRect().top,e.container.el.style.height="calc( 100vh - "+e.score.board.h+"px)",e.container.x=e.container.el.offsetWidth,e.container.y=e.container.el.offsetHeight}function f(){window.pageYOffset>e.score.board.y-e.container.y&&0===e.status&&(e.score.board.el.classList.add("fixed"),s())}function v(t,n,s,a){let o;o=0,e.timing.timers[t]=window.setInterval((function(){n(),++o===a&&window.clearInterval(e.timing.timers[t])}),s)}function y(){const e=function(e){let t,n;const s=e+"=",a=document.cookie.split(";");for(t=0;t<a.length;t++){for(n=a[t];" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(s))return n.substring(s.length,n.length)}return""}("uri-space-invaders-high-score");return""===e?(M(0),0):e}function M(e){!function(e,t,n){const s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3);const a="expires="+s.toUTCString();document.cookie=e+"="+t+";"+a+";path=/"}("uri-space-invaders-high-score",e,365)}window.addEventListener("load",(function(){const s=URIMODERN.path.theme+"/features/2019/space-invaders/";if(e={unit:16,status:0,pointcap:50,n:0,els:{page:document.getElementById("page"),habitat:document.getElementById("habitat-creatures")},buttons:{},creatures:{},types:{tunicate1:{slug:"tunicate-1",name:"Styela clava"},tunicate2:{slug:"tunicate-2",name:"Ciona intestinalis"},seaweed1:{slug:"seaweed-1",name:"Grateloupia turuturu"},seaweed2:{slug:"seaweed-2",name:"Codium fragile"},crab:{slug:"crab",name:"Hemigrapsus sanguineus"}},container:{},endscreen:{},score:{points:0,spawned:0,removed:0,types:{},high:y(),board:{wrapper:document.getElementById("scoreboard-wrapper")}},timing:{init:2e3,duration:6e4,timers:{}},audio:{bounce:new Audio(s+"mp3/bounce.mp3"),elevate:new Audio(s+"mp3/elevate.mp3"),shoot:new Audio(s+"mp3/shoot.mp3"),end:new Audio(s+"mp3/end.mp3"),menu:new Audio(s+"mp3/menu.mp3")}},document.body.classList.contains("home")||document.body.classList.contains("ln-preview"))return void function(){const s=document.getElementById("feature-hero").querySelector(".cl-hero"),a=s.querySelector(".still");s.insertBefore(t(),a),s.insertBefore(n(),a),e.score.board.h=0,e.container.x=e.container.el.offsetWidth,e.container.y=e.container.el.offsetHeight,e.n=e.container.y/16,l(),v("homepageCreatures",c,1e3,20)}();document.body.classList.add("si-gameplay-supported"),e.story={h:document.getElementById("story").offsetHeight,top:document.getElementById("story").getBoundingClientRect().top},e.game=document.createElement("div"),e.game.id="game",e.game.appendChild(function(){let t,n,s,a;e.endscreen.el=document.createElement("div"),e.endscreen.el.id="endscreen",e.endscreen.el.className="modal",e.endscreen.el.innerHTML="<h1>Game <br> Over</h1>";const r=document.createElement("div");r.id="new-high-score",r.innerHTML="New High Score",e.endscreen.el.appendChild(r);const i=document.createElement("div");for(s in i.id="game-stats",e.endscreen.stats={},e.types)a=e.types[s].slug,t=document.createElement("div"),t.className="stat-wrapper",n=document.createElement("span"),n.className="stat-creature "+a,t.appendChild(n),e.endscreen.stats[a]=document.createElement("span"),e.endscreen.stats[a].className="stat-label",e.endscreen.stats[a].innerHTML=0,t.appendChild(e.endscreen.stats[a]),n=document.createElement("span"),n.className="stat-creature-name",n.innerHTML=e.types[s].name,t.appendChild(n),i.appendChild(t);return e.endscreen.el.appendChild(i),e.buttons.reset=document.createElement("div"),e.buttons.reset.id="reset-game",e.buttons.reset.className="retro-button",e.buttons.reset.innerHTML="play again",e.endscreen.el.appendChild(e.buttons.reset),t=document.createElement("div"),t.id="remove-game",t.innerHTML="or, just read the story",t.addEventListener("click",o,!1),e.endscreen.el.appendChild(t),e.endscreen.el}()),e.game.appendChild((e.countdown=document.createElement("div"),e.countdown.id="countdown",e.countdown.className="modal",e.countdown.innerHTML='Invasives coming!<div class="counter">3</div>',e.countdown)),e.game.appendChild(t()),e.game.appendChild(n()),e.score.board.wrapper.appendChild(function(){e.buttons.controls=document.createElement("div"),e.buttons.controls.id="controls",e.buttons.pause=document.createElement("div"),e.buttons.pause.id="pause-game",e.buttons.pause.innerHTML="pause",e.buttons.controls.appendChild(e.buttons.pause),e.buttons.resume=document.createElement("div"),e.buttons.resume.id="resume-game",e.buttons.resume.innerHTML="resume",e.buttons.controls.appendChild(e.buttons.resume);const t=document.createElement("div");t.id="scores";const n=document.createElement("div");n.id="points",n.innerHTML='<div class="label">score</div>',e.score.board.points=document.createElement("div"),e.score.board.points.className="score",e.score.board.points.innerHTML=g(e.score.points),n.appendChild(e.score.board.points),t.appendChild(n);const s=document.createElement("div");s.id="high",s.innerHTML='<div class="label">high</div>',e.score.board.high=document.createElement("div"),e.score.board.high.className="score",e.score.board.high.innerHTML=g(e.score.high),s.appendChild(e.score.board.high),t.appendChild(s);const a=document.createElement("div");a.id="progress",e.progress=document.createElement("div"),e.progress.id="progress-bar",a.appendChild(e.progress);const o=document.createElement("div");return o.id="progress-label",o.innerHTML="Complete Invasion! --\x3e",a.appendChild(o),e.score.board.el=document.createElement("div"),e.score.board.el.id="scoreboard",e.score.board.el.appendChild(e.buttons.controls),e.score.board.el.appendChild(t),e.score.board.el.appendChild(a),e.score.board.el}()),document.getElementById("main").appendChild(e.game),e.score.board.h=e.score.board.el.offsetHeight,e.score.board.y=e.score.board.el.getBoundingClientRect().top,e.score.board.parent=e.score.board.wrapper.parentElement,e.container.el.style.height="calc( 100vh - "+e.score.board.h+"px)",e.container.x=e.container.el.offsetWidth,e.container.y=e.container.el.offsetHeight,e.buttons.reset.addEventListener("click",(function(){u(e.audio.menu)}),!1),e.buttons.pause.addEventListener("click",(function(){1===e.status&&u(e.audio.menu)}),!1),e.buttons.resume.addEventListener("click",(function(){3===e.status&&u(e.audio.menu)}),!1),function(){let t,n,s;e.els.habitat.innerHTML="";const a=document.createElement("div");e.els.habitat.appendChild(a),v("populateCreatureBox",(function(){t=i(),n=e.unit*Math.floor(48*Math.random()+1),s=Math.floor(10*Math.random()+1),t.div.setAttribute("style","left:"+n+"px; z-index:"+s),a.appendChild(t.div)}),50,15)}(),l(),window.addEventListener("resize",b,!1),window.addEventListener("scroll",f,!1)}),!1)}();
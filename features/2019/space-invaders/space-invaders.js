/* built */!function(){"use strict";var e;function t(){return e.container.el=document.createElement("div"),e.container.el.id="creature-container",e.container.el}function n(){return e.bubbles=document.createElement("div"),e.bubbles.id="bubbles-container",e.bubbles}function a(){e.countdown.classList.remove("visible"),e.els.page.classList.add("gameplay"),1!=e.status&&(e.status=1,o(),f("initialCreatures",d,50,10),e.timing.start=Date.now(),setTimeout(s,e.timing.init))}function s(){var t,n,a;1==e.status&&(t=Date.now()-e.timing.start,n=function(e,t,n){var a,s;return a=Math.abs(t)-Math.abs(e),s=(Math.abs(n)-Math.abs(e))/a,Math.pow(s,2)}(0,e.timing.duration,t),a=Math.max(120,Math.min(300,e.container.x*e.container.y/1e6*300)),e.timing.interval=Math.max(a,e.timing.init-e.timing.init*n),d(),e.n++,setTimeout(s,e.timing.interval))}function r(){window.clearInterval(e.timing.timers.endGame),e.els.page.classList.remove("gameplay"),e.score.board.parent.removeChild(e.score.board.wrapper),document.getElementById("main").removeChild(e.game),document.body.classList.remove("si-gameplay-supported")}function o(){var t,n;1==e.status&&(e.score.board.points.innerHTML=g(e.score.points),e.score.points>=e.score.high&&(e.score.board.high.innerHTML=g(e.score.points)),t=e.score.spawned-e.score.removed,n=100/e.pointcap*t,e.progress.style.width=n+"%",50>n?e.progress.classList.remove("alert"):75>n?(e.progress.classList.remove("warning"),e.progress.classList.add("alert")):90>n?(e.progress.classList.remove("alert","danger"),e.progress.classList.add("warning")):100>n&&(e.progress.classList.remove("warning"),e.progress.classList.add("danger")),e.pointcap==t&&function(){var t,n;for(t in e.status=2,e.endscreen.stats)n=0,null!=e.score.types[t]&&(n=e.score.types[t]),e.endscreen.stats[t].innerHTML=n;u(e.audio.end),e.container.el.classList.add("endgame"),e.endscreen.el.classList.add("visible"),e.score.points>y()&&(M(e.score.points),e.endscreen.el.classList.add("new-high")),f("endGame",d,20,Math.floor(Math.max(200,Math.min(600,e.container.x*e.container.y/1e6*400))))}())}function i(){var t,n,a,s={};switch(n=Math.floor(1e3*Math.random()),a=Math.floor(3*Math.random()+1),300>n?s.type=e.types.tunicate1.slug:600>n?s.type=e.types.tunicate2.slug:750>n?s.type=e.types.seaweed1.slug:900>n?s.type=e.types.seaweed2.slug:1e3>n&&(s.type=e.types.crab.slug),a){case 1:t="slow";break;case 2:t="fast";break;default:t=""}return s.div=document.createElement("div"),s.div.className="creature "+s.type+" "+t,s}function d(){var t,n,a,s,r,d,l,u,m,p,h,g;t=i(),p=t.type,h=e.container.el.querySelectorAll("."+p+":not(.destroyed)"),g=Math.floor(Math.random()*h.length),n=h.length>0?h[g].parentNode.getAttribute("id"):null,m="c_"+Math.random().toString(36).substr(2,9),s={left:0,right:e.container.x-128,top:Math.max(128,e.container.y-16*e.n),bottom:e.container.y-e.score.board.h},700>(a=Math.floor(1e3*Math.random()))&&null!=n&&"crab"!=t.type&&0<e.n?(d=Math.min(s.right,Math.max(128,e.creatures[n].x+e.unit*Math.floor(17*Math.random()-8))),l=Math.min(s.bottom,Math.max(128,e.creatures[n].y+e.unit*Math.floor(17*Math.random()-8)))):(d=Math.max(s.left,e.unit*Math.floor(Math.random()*(s.right/e.unit))),l=Math.max(s.top,e.unit*Math.floor(Math.random()*(s.bottom/e.unit)))),u=Math.floor(10*Math.random()+1),(r=document.createElement("div")).id=m,r.className="creature-wrapper",500>a&&r.classList.add("flipped"),r.setAttribute("style","top:"+l+"px; left:"+d+"px; z-index:"+u),r.appendChild(t.div),1==e.status&&r.addEventListener("click",c.bind(null,m),!1),e.creatures[m]={el:r,x:d,y:l,type:t.type,status:1},e.container.el.appendChild(r),e.score.spawned++,o()}function c(t){var n,a;switch((n=e.creatures[t]).el.classList.add("destroyed"),n.status=0,null==e.score.types[n.type]?e.score.types[n.type]=1:e.score.types[n.type]++,setTimeout((function(){e.container.el.removeChild(n.el)}),5e3),n.type){case e.types.crab.slug:u(e.audio.elevate),a=30;break;case e.types.tunicate1.slug:u(e.audio.bounce),a=10;break;case e.types.tunicate2.slug:u(e.audio.bounce),a=30;break;case e.types.seaweed1.slug:case e.types.seaweed2.slug:u(e.audio.shoot),a=20;break;default:u(e.audio.shoot),a=10}e.score.removed++,e.score.points+=a,o()}function l(){var t,n,a,s,r;t=Math.floor(7001*Math.random()+1e3),n="b_"+Math.random().toString(36).substr(2,9),a=e.unit*Math.floor(Math.random()*(e.container.x/e.unit)),s=e.unit*Math.floor(Math.random()*(e.container.y/e.unit)),(r=document.createElement("div")).id=n,r.className="bubbles bubbles-1",r.setAttribute("style","top:"+s+"px; left:"+a+"px"),e.bubbles.appendChild(r),setTimeout((function(){e.bubbles.removeChild(r)}),5e3),setTimeout(l,t)}function u(t){var n,a,s;a=m,s=p,e.audio.menu==t&&(a=function(){t.onended=h},s=h),t.paused?void 0!==(n=t.play())&&n.then(a).catch(s):t.currentTime=0}function m(){}function p(){}function h(){switch(e.status){case 0:a();break;case 1:e.status=3,e.timing.paused=Date.now(),e.container.el.classList.add("paused"),e.buttons.controls.classList.add("paused"),e.els.page.classList.remove("gameplay");break;case 2:window.clearInterval(e.timing.timers.endGame),e.container.el.innerHTML="",e.container.el.classList.remove("endgame"),e.endscreen.el.classList.remove("visible","new-high"),e.progress.className="",e.score.points=0,e.score.high=y(),e.score.spawned=0,e.score.removed=0,e.score.types={},e.n=0,e.score.board.high.innerHTML=g(e.score.high),a();break;case 3:t=Date.now(),e.status=1,e.timing.start+=t-e.timing.paused,e.container.el.classList.remove("paused"),e.buttons.controls.classList.remove("paused"),e.els.page.classList.add("gameplay"),setTimeout(s,e.timing.interval)}var t}function g(e){var t="00000"+e;return t.substr(t.length-5)}function b(){e.score.board.h=e.score.board.el.offsetHeight,e.score.board.y=e.score.board.el.getBoundingClientRect().top,e.container.el.style.height="calc( 100vh - "+e.score.board.h+"px)",e.container.x=e.container.el.offsetWidth,e.container.y=e.container.el.offsetHeight}function v(){window.pageYOffset>e.score.board.y-e.container.y&&0==e.status&&(e.score.board.el.classList.add("fixed"),a())}function f(t,n,a,s){var r;r=0,e.timing.timers[t]=window.setInterval((function(){n(),++r===s&&window.clearInterval(e.timing.timers[t])}),a)}function y(){var e;return""==(e=function(e){var t,n,a,s;for(t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(s=n[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}("uri-space-invaders-high-score"))?(M(0),0):e}function M(e){var t,n,a,s,r;t="uri-space-invaders-high-score",n=e,a=365,(s=new Date).setTime(s.getTime()+24*a*60*60*1e3),r="expires="+s.toUTCString(),document.cookie=t+"="+n+";"+r+";path=/"}window.addEventListener("load",(function(){var a;if(a=URIMODERN.path.theme+"/features/2019/space-invaders/",e={unit:16,status:0,pointcap:50,n:0,els:{page:document.getElementById("page"),habitat:document.getElementById("habitat-creatures")},buttons:{},creatures:{},types:{tunicate1:{slug:"tunicate-1",name:"Styela clava"},tunicate2:{slug:"tunicate-2",name:"Ciona intestinalis"},seaweed1:{slug:"seaweed-1",name:"Grateloupia turuturu"},seaweed2:{slug:"seaweed-2",name:"Codium fragile"},crab:{slug:"crab",name:"Hemigrapsus sanguineus"}},container:{},endscreen:{},score:{points:0,spawned:0,removed:0,types:{},high:y(),board:{wrapper:document.getElementById("scoreboard-wrapper")}},timing:{init:2e3,duration:6e4,timers:{}},audio:{bounce:new Audio(a+"mp3/bounce.mp3"),elevate:new Audio(a+"mp3/elevate.mp3"),shoot:new Audio(a+"mp3/shoot.mp3"),end:new Audio(a+"mp3/end.mp3"),menu:new Audio(a+"mp3/menu.mp3")}},document.body.classList.contains("home")||document.body.classList.contains("ln-preview"))return s=document.getElementById("feature-hero").querySelector(".cl-hero"),o=s.querySelector(".still"),s.insertBefore(t(),o),s.insertBefore(n(),o),e.score.board.h=0,e.container.x=e.container.el.offsetWidth,e.container.y=e.container.el.offsetHeight,e.n=e.container.y/16,l(),void f("homepageCreatures",d,1e3,20);var s,o;document.body.classList.add("si-gameplay-supported"),e.story={h:document.getElementById("story").offsetHeight,top:document.getElementById("story").getBoundingClientRect().top},e.game=document.createElement("div"),e.game.id="game",e.game.appendChild(function(){var t,n,a,s,o,i;for(o in e.endscreen.el=document.createElement("div"),e.endscreen.el.id="endscreen",e.endscreen.el.className="modal",e.endscreen.el.innerHTML="<h1>Game <br> Over</h1>",(n=document.createElement("div")).id="new-high-score",n.innerHTML="New High Score",e.endscreen.el.appendChild(n),(t=document.createElement("div")).id="game-stats",e.endscreen.stats={},e.types)i=e.types[o].slug,(a=document.createElement("div")).className="stat-wrapper",(s=document.createElement("span")).className="stat-creature "+i,a.appendChild(s),e.endscreen.stats[i]=document.createElement("span"),e.endscreen.stats[i].className="stat-label",e.endscreen.stats[i].innerHTML=0,a.appendChild(e.endscreen.stats[i]),(s=document.createElement("span")).className="stat-creature-name",s.innerHTML=e.types[o].name,a.appendChild(s),t.appendChild(a);return e.endscreen.el.appendChild(t),e.buttons.reset=document.createElement("div"),e.buttons.reset.id="reset-game",e.buttons.reset.className="retro-button",e.buttons.reset.innerHTML="play again",e.endscreen.el.appendChild(e.buttons.reset),(a=document.createElement("div")).id="remove-game",a.innerHTML="or, just read the story",a.addEventListener("click",r,!1),e.endscreen.el.appendChild(a),e.endscreen.el}()),e.game.appendChild((e.countdown=document.createElement("div"),e.countdown.id="countdown",e.countdown.className="modal",e.countdown.innerHTML='Invasives coming!<div class="counter">3</div>',e.countdown)),e.game.appendChild(t()),e.game.appendChild(n()),e.score.board.wrapper.appendChild((e.buttons.controls=document.createElement("div"),e.buttons.controls.id="controls",e.buttons.pause=document.createElement("div"),e.buttons.pause.id="pause-game",e.buttons.pause.innerHTML="pause",e.buttons.controls.appendChild(e.buttons.pause),e.buttons.resume=document.createElement("div"),e.buttons.resume.id="resume-game",e.buttons.resume.innerHTML="resume",e.buttons.controls.appendChild(e.buttons.resume),(M=document.createElement("div")).id="scores",(w=document.createElement("div")).id="points",w.innerHTML='<div class="label">score</div>',e.score.board.points=document.createElement("div"),e.score.board.points.className="score",e.score.board.points.innerHTML=g(e.score.points),w.appendChild(e.score.board.points),M.appendChild(w),(L=document.createElement("div")).id="high",L.innerHTML='<div class="label">high</div>',e.score.board.high=document.createElement("div"),e.score.board.high.className="score",e.score.board.high.innerHTML=g(e.score.high),L.appendChild(e.score.board.high),M.appendChild(L),(E=document.createElement("div")).id="progress",e.progress=document.createElement("div"),e.progress.id="progress-bar",E.appendChild(e.progress),(C=document.createElement("div")).id="progress-label",C.innerHTML="Complete Invasion! --\x3e",E.appendChild(C),e.score.board.el=document.createElement("div"),e.score.board.el.id="scoreboard",e.score.board.el.appendChild(e.buttons.controls),e.score.board.el.appendChild(M),e.score.board.el.appendChild(E),e.score.board.el)),document.getElementById("main").appendChild(e.game),e.score.board.h=e.score.board.el.offsetHeight,e.score.board.y=e.score.board.el.getBoundingClientRect().top,e.score.board.parent=e.score.board.wrapper.parentElement,e.container.el.style.height="calc( 100vh - "+e.score.board.h+"px)",e.container.x=e.container.el.offsetWidth,e.container.y=e.container.el.offsetHeight,e.buttons.reset.addEventListener("click",(function(){u(e.audio.menu)}),!1),e.buttons.pause.addEventListener("click",(function(){1==e.status&&u(e.audio.menu)}),!1),e.buttons.resume.addEventListener("click",(function(){3==e.status&&u(e.audio.menu)}),!1),e.els.habitat.innerHTML="",c=document.createElement("div"),e.els.habitat.appendChild(c),f("populateCreatureBox",(function(){m=i(),p=e.unit*Math.floor(48*Math.random()+1),h=Math.floor(10*Math.random()+1),m.div.setAttribute("style","left:"+p+"px; z-index:"+h),c.appendChild(m.div)}),50,15),l(),window.addEventListener("resize",b,!1),window.addEventListener("scroll",v,!1);var c,m,p,h;var M,w,L,E,C}),!1)}();
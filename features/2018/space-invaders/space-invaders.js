/* built */!function(){"use strict";var u;function n(){u.countdown.classList.remove("visible"),u.els.page.classList.add("gameplay"),1!=u.status&&(u.status=1,p(),M(c,50,10),u.timing.start=Date.now(),setTimeout(d,u.timing.init))}function d(){var e,t,n,a,s,o,r,i;1==u.status&&(e=Date.now()-u.timing.start,a=0,s=u.timing.duration,o=e,r=Math.abs(s)-Math.abs(a),i=(Math.abs(o)-Math.abs(a))/r,t=Math.pow(i,2),n=Math.max(120,Math.min(380,u.container.x*u.container.y/1e6*300)),u.timing.interval=Math.max(n,u.timing.init-u.timing.init*t),c(),u.n++,setTimeout(d,u.timing.interval))}function p(){var e,t;1==u.status&&(u.score.board.points.innerHTML=v(u.score.points),u.score.points>=u.score.high&&(u.score.board.high.innerHTML=v(u.score.points)),e=u.score.spawned-u.score.removed,t=100/u.pointcap*e,u.progress.style.width=t+"%",t<50?u.progress.classList.remove("alert"):t<75?(u.progress.classList.remove("warning"),u.progress.classList.add("alert")):t<90?(u.progress.classList.remove("alert","danger"),u.progress.classList.add("warning")):t<100&&(u.progress.classList.remove("warning"),u.progress.classList.add("danger")),u.pointcap==e&&function(){var e,t;for(e in u.status=2,u.endscreen.stats)t=0,null!=u.score.types[e]&&(t=u.score.types[e]),u.endscreen.stats[e].innerHTML=t;u.audio.end.play(),u.container.el.classList.add("endgame"),u.endscreen.el.classList.add("visible"),u.score.points>w()&&a(u.score.points),M(c,20,Math.floor(Math.max(200,Math.min(600,u.container.x*u.container.y/1e6*400))))}())}function m(){var e,t,n,a={};switch(t=Math.floor(1e3*Math.random()),n=Math.floor(3*Math.random()+1),t<350?a.type=u.types.tunicate1:t<700?a.type=u.types.tunicate2:t<900?a.type=u.types.seaweed1:t<1e3&&(a.type=u.types.crab),n){case 1:e="slow";break;case 2:e="fast";break;default:e=""}return a.div=document.createElement("div"),a.div.className="creature "+a.type+" "+e,a}function c(){var e,t,n,a,s,o,r,i,d,c,l;e=m(),d=e.type,c=u.container.el.querySelectorAll("."+d+":not(.destroyed)"),l=Math.floor(Math.random()*c.length),t=0<c.length?c[l].parentNode.getAttribute("id"):null,i="c_"+Math.random().toString(36).substr(2,9),n={left:0,right:u.container.x-128,top:Math.max(128,u.container.y-16*u.n),bottom:u.container.y-u.score.board.h},Math.floor(1e3*Math.random())<700&&null!=t&&"crab"!=e.type?(s=Math.min(n.right,Math.max(128,u.creatures[t].x+u.unit*Math.floor(17*Math.random()-8))),o=Math.min(n.bottom,Math.max(128,u.creatures[t].y+u.unit*Math.floor(17*Math.random()-8)))):(s=Math.max(n.left,u.unit*Math.floor(Math.random()*(n.right/u.unit))),o=Math.max(n.top,u.unit*Math.floor(Math.random()*(n.bottom/u.unit)))),r=Math.floor(10*Math.random()+1),(a=document.createElement("div")).id=i,a.className="creature-wrapper",a.style="top:"+o+"px; left:"+s+"px; z-index:"+r,a.appendChild(e.div),1==u.status&&a.addEventListener("click",function(e){var t,n;switch((t=u.creatures[e]).el.classList.add("destroyed"),t.status=0,null==u.score.types[t.type]?u.score.types[t.type]=1:u.score.types[t.type]++,setTimeout(function(){u.container.el.removeChild(t.el)},5e3),t.type){case u.types.crab:b(u.audio.elevate),n=30;break;case u.types.tunicate1:b(u.audio.bounce),n=10;break;case u.types.tunicate2:b(u.audio.bounce),n=30;break;case u.types.seaweed1:b(u.audio.shoot),n=20;break;default:b(u.audio.shoot),n=10}u.score.removed++,u.score.points+=n,p()}.bind(null,i),!1),u.creatures[i]={el:a,x:s,y:o,type:e.type,status:1},u.container.el.appendChild(a),u.score.spawned++,p()}function h(){var e,t,n,a,s;e=Math.floor(7001*Math.random()+1e3),t="b_"+Math.random().toString(36).substr(2,9),n=u.unit*Math.floor(Math.random()*(u.container.x/u.unit)),a=u.unit*Math.floor(Math.random()*(u.container.y/u.unit)),(s=document.createElement("div")).id=t,s.className="bubbles bubbles-1",s.style="top:"+a+"px; left:"+n+"px",u.bubbles.appendChild(s),setTimeout(function(){u.bubbles.removeChild(s)},5e3),setTimeout(h,e)}function b(e){e.paused?e.play():e.currentTime=0}function g(){switch(u.status){case 0:n();break;case 1:u.status=3,u.timing.paused=Date.now(),u.container.el.classList.add("paused"),u.buttons.controls.classList.add("paused"),u.els.page.classList.remove("gameplay");break;case 2:window.clearInterval(u.endtimer),u.container.el.innerHTML="",u.container.el.classList.remove("endgame"),u.endscreen.el.classList.remove("visible"),u.progress.className="",u.score.points=0,u.score.high=w(),u.score.spawned=0,u.score.removed=0,u.score.types={},u.n=0,u.score.board.high.innerHTML=v(u.score.high),n();break;case 3:e=Date.now(),u.status=1,u.timing.start+=e-u.timing.paused,u.container.el.classList.remove("paused"),u.buttons.controls.classList.remove("paused"),u.els.page.classList.add("gameplay"),setTimeout(d,u.timing.interval)}var e}function v(e){var t="00000"+e;return t.substr(t.length-5)}function f(){u.score.board.h=u.score.board.el.offsetHeight,u.score.board.y=u.score.board.el.getBoundingClientRect().top,u.container.el.style.height="calc( 100vh - "+u.score.board.h+"px)",u.container.x=u.container.el.offsetWidth,u.container.y=u.container.el.offsetHeight}function y(){var e,t;window.pageYOffset>u.score.board.y-u.container.y&&0==u.status&&(u.score.board.el.classList.add("fixed"),u.status=4,e=4,u.countdown.classList.add("visible"),(t=function(){e--,0<(u.countdown.innerHTML=e)?setTimeout(t,1e3):n()})())}function M(e,t,n){var a,s;a=0,s=window.setInterval(function(){e(),++a===n&&window.clearInterval(s)},t)}function w(){var e;return""==(e=function(e){var t,n,a,s;for(t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(s=n[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}("uri-space-invaders-high-score"))?(a(0),0):e}function a(e){var t,n,a,s,o;t="uri-space-invaders-high-score",n=e,a=365,(s=new Date).setTime(s.getTime()+24*a*60*60*1e3),o="expires="+s.toUTCString(),document.cookie=t+"="+n+";"+o+";path=/"}window.addEventListener("load",function(){var e,t;e=URIMODERN.path.theme+"/features/2018/space-invaders/",u={unit:16,status:0,pointcap:50,n:0,els:{page:document.getElementById("page"),habitat:document.getElementById("habitat-creatures")},story:{h:document.getElementById("story").offsetHeight,top:document.getElementById("story").getBoundingClientRect().top},buttons:{},creatures:{},types:{tunicate1:"tunicate-1",tunicate2:"tunicate-2",seaweed1:"seaweed-1",crab:"crab"},container:{},endscreen:{},score:{points:0,spawned:0,removed:0,types:{},high:w(),board:{wrapper:document.getElementById("scoreboard-wrapper")}},timing:{init:2e3,duration:6e4},audio:{bounce:new Audio(e+"mp3/bounce.mp3"),elevate:new Audio(e+"mp3/elevate.mp3"),shoot:new Audio(e+"mp3/shoot.mp3"),end:new Audio(e+"mp3/end.mp3"),menu:new Audio(e+"mp3/menu.mp3")}},(t=document.createElement("div")).id="game",t.appendChild(function(){var e,t,n,a,s;for(a in u.endscreen.el=document.createElement("div"),u.endscreen.el.id="endscreen",u.endscreen.el.className="modal",u.endscreen.el.innerHTML="<h1>Game <br> Over</h1>",(e=document.createElement("div")).id="game-stats",u.endscreen.stats={},u.types)s=u.types[a],(t=document.createElement("div")).className="stat-wrapper",(n=document.createElement("span")).className="stat-creature "+s,t.appendChild(n),u.endscreen.stats[s]=document.createElement("span"),u.endscreen.stats[s].className="stat-label",u.endscreen.stats[s].innerHTML=0,t.appendChild(u.endscreen.stats[s]),e.appendChild(t);return u.endscreen.el.appendChild(e),u.buttons.reset=document.createElement("div"),u.buttons.reset.id="reset-game",u.buttons.reset.className="retro-button",u.buttons.reset.innerHTML="play again",u.endscreen.el.appendChild(u.buttons.reset),u.endscreen.el}()),t.appendChild((u.countdown=document.createElement("div"),u.countdown.id="countdown",u.countdown.className="modal",u.countdown.innerHTML=3,u.countdown)),t.appendChild((u.container.el=document.createElement("div"),u.container.el.id="creature-container",u.container.el)),t.appendChild((u.bubbles=document.createElement("div"),u.bubbles.id="bubbles-container",u.bubbles)),u.score.board.wrapper.appendChild((u.buttons.controls=document.createElement("div"),u.buttons.controls.id="controls",u.buttons.pause=document.createElement("div"),u.buttons.pause.id="pause-game",u.buttons.pause.innerHTML="pause",u.buttons.controls.appendChild(u.buttons.pause),u.buttons.resume=document.createElement("div"),u.buttons.resume.id="resume-game",u.buttons.resume.innerHTML="resume",u.buttons.controls.appendChild(u.buttons.resume),(r=document.createElement("div")).id="scores",(i=document.createElement("div")).id="points",i.innerHTML='<div class="label">score</div>',u.score.board.points=document.createElement("div"),u.score.board.points.className="score",u.score.board.points.innerHTML=v(u.score.points),i.appendChild(u.score.board.points),r.appendChild(i),(d=document.createElement("div")).id="high",d.innerHTML='<div class="label">high</div>',u.score.board.high=document.createElement("div"),u.score.board.high.className="score",u.score.board.high.innerHTML=v(u.score.high),d.appendChild(u.score.board.high),r.appendChild(d),(c=document.createElement("div")).id="progress",u.progress=document.createElement("div"),u.progress.id="progress-bar",c.appendChild(u.progress),(l=document.createElement("div")).id="progress-label",l.innerHTML="Complete Invasion! --\x3e",c.appendChild(l),u.score.board.el=document.createElement("div"),u.score.board.el.id="scoreboard",u.score.board.el.appendChild(u.buttons.controls),u.score.board.el.appendChild(r),u.score.board.el.appendChild(c),u.score.board.el)),document.getElementById("main").appendChild(t),u.score.board.h=u.score.board.el.offsetHeight,u.score.board.y=u.score.board.el.getBoundingClientRect().top,u.container.el.style.height="calc( 100vh - "+u.score.board.h+"px)",u.container.x=u.container.el.offsetWidth,u.container.y=u.container.el.offsetHeight,u.buttons.reset.addEventListener("click",function(){b(u.audio.menu)},!1),u.buttons.pause.addEventListener("click",function(){1==u.status&&b(u.audio.menu)},!1),u.buttons.resume.addEventListener("click",function(){3==u.status&&b(u.audio.menu)},!1),u.els.habitat.innerHTML="",n=document.createElement("div"),u.els.habitat.appendChild(n),M(function(){a=m(),s=u.unit*Math.floor(48*Math.random()+1),o=Math.floor(10*Math.random()+1),a.div.style="left:"+s+"px; z-index:"+o,n.appendChild(a.div)},50,15),h(),u.audio.menu.onended=g,window.addEventListener("resize",f,!1),window.addEventListener("scroll",y,!1);var n,a,s,o;var r,i,d,c,l},!1)}();
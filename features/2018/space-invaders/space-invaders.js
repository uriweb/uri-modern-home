/* built */!function(){"use strict";var m;function n(){m.countdown.classList.remove("visible"),m.els.page.classList.add("gameplay"),1!=m.status&&(m.status=1,p(),y("initialCreatures",c,50,10),m.timing.start=Date.now(),setTimeout(d,m.timing.init))}function d(){var e,t,n,a,s,r,o,i;1==m.status&&(e=Date.now()-m.timing.start,a=0,s=m.timing.duration,r=e,o=Math.abs(s)-Math.abs(a),i=(Math.abs(r)-Math.abs(a))/o,t=Math.pow(i,2),n=Math.max(120,Math.min(300,m.container.x*m.container.y/1e6*300)),m.timing.interval=Math.max(n,m.timing.init-m.timing.init*t),c(),m.n++,setTimeout(d,m.timing.interval))}function l(){window.clearInterval(m.timing.timers.endGame),m.els.page.classList.remove("gameplay"),m.score.board.parent.removeChild(m.score.board.wrapper),document.getElementById("main").removeChild(m.game)}function p(){var e,t;1==m.status&&(m.score.board.points.innerHTML=g(m.score.points),m.score.points>=m.score.high&&(m.score.board.high.innerHTML=g(m.score.points)),e=m.score.spawned-m.score.removed,t=100/m.pointcap*e,m.progress.style.width=t+"%",t<50?m.progress.classList.remove("alert"):t<75?(m.progress.classList.remove("warning"),m.progress.classList.add("alert")):t<90?(m.progress.classList.remove("alert","danger"),m.progress.classList.add("warning")):t<100&&(m.progress.classList.remove("warning"),m.progress.classList.add("danger")),m.pointcap==e&&function(){var e,t;for(e in m.status=2,m.endscreen.stats)t=0,null!=m.score.types[e]&&(t=m.score.types[e]),m.endscreen.stats[e].innerHTML=t;b(m.audio.end),m.container.el.classList.add("endgame"),m.endscreen.el.classList.add("visible"),m.score.points>M()&&(a(m.score.points),m.endscreen.el.classList.add("new-high")),y("endGame",c,20,Math.floor(Math.max(200,Math.min(600,m.container.x*m.container.y/1e6*400))))}())}function h(){var e,t,n,a={};switch(t=Math.floor(1e3*Math.random()),n=Math.floor(3*Math.random()+1),t<300?a.type=m.types.tunicate1:t<600?a.type=m.types.tunicate2:t<750?a.type=m.types.seaweed1:t<900?a.type=m.types.seaweed2:t<1e3&&(a.type=m.types.crab),n){case 1:e="slow";break;case 2:e="fast";break;default:e=""}return a.div=document.createElement("div"),a.div.className="creature "+a.type+" "+e,a}function c(){var e,t,n,a,s,r,o,i,d,c,l,u;e=h(),c=e.type,l=m.container.el.querySelectorAll("."+c+":not(.destroyed)"),u=Math.floor(Math.random()*l.length),t=0<l.length?l[u].parentNode.getAttribute("id"):null,d="c_"+Math.random().toString(36).substr(2,9),a={left:0,right:m.container.x-128,top:Math.max(128,m.container.y-16*m.n),bottom:m.container.y-m.score.board.h},(n=Math.floor(1e3*Math.random()))<700&&null!=t&&"crab"!=e.type&&0<m.n?(r=Math.min(a.right,Math.max(128,m.creatures[t].x+m.unit*Math.floor(17*Math.random()-8))),o=Math.min(a.bottom,Math.max(128,m.creatures[t].y+m.unit*Math.floor(17*Math.random()-8)))):(r=Math.max(a.left,m.unit*Math.floor(Math.random()*(a.right/m.unit))),o=Math.max(a.top,m.unit*Math.floor(Math.random()*(a.bottom/m.unit)))),i=Math.floor(10*Math.random()+1),(s=document.createElement("div")).id=d,s.className="creature-wrapper",n<500&&s.classList.add("flipped"),s.style="top:"+o+"px; left:"+r+"px; z-index:"+i,s.appendChild(e.div),1==m.status&&s.addEventListener("click",function(e){var t,n;switch((t=m.creatures[e]).el.classList.add("destroyed"),t.status=0,null==m.score.types[t.type]?m.score.types[t.type]=1:m.score.types[t.type]++,setTimeout(function(){m.container.el.removeChild(t.el)},5e3),t.type){case m.types.crab:b(m.audio.elevate),n=30;break;case m.types.tunicate1:b(m.audio.bounce),n=10;break;case m.types.tunicate2:b(m.audio.bounce),n=30;break;case m.types.seaweed1:case m.types.seaweed2:b(m.audio.shoot),n=20;break;default:b(m.audio.shoot),n=10}m.score.removed++,m.score.points+=n,p()}.bind(null,d),!1),m.creatures[d]={el:s,x:r,y:o,type:e.type,status:1},m.container.el.appendChild(s),m.score.spawned++,p()}function u(){var e,t,n,a,s;e=Math.floor(7001*Math.random()+1e3),t="b_"+Math.random().toString(36).substr(2,9),n=m.unit*Math.floor(Math.random()*(m.container.x/m.unit)),a=m.unit*Math.floor(Math.random()*(m.container.y/m.unit)),(s=document.createElement("div")).id=t,s.className="bubbles bubbles-1",s.style="top:"+a+"px; left:"+n+"px",m.bubbles.appendChild(s),setTimeout(function(){m.bubbles.removeChild(s)},5e3),setTimeout(u,e)}function b(e){var t,n,a;n=s,a=r,m.audio.menu==e&&(n=function(){e.onended=o},a=o),e.paused?void 0!==(t=e.play())&&t.then(n).catch(a):e.currentTime=0}function s(){}function r(){}function o(){switch(m.status){case 0:n();break;case 1:m.status=3,m.timing.paused=Date.now(),m.container.el.classList.add("paused"),m.buttons.controls.classList.add("paused"),m.els.page.classList.remove("gameplay");break;case 2:window.clearInterval(m.timing.timers.endGame),m.container.el.innerHTML="",m.container.el.classList.remove("endgame"),m.endscreen.el.classList.remove("visible","new-high"),m.progress.className="",m.score.points=0,m.score.high=M(),m.score.spawned=0,m.score.removed=0,m.score.types={},m.n=0,m.score.board.high.innerHTML=g(m.score.high),n();break;case 3:e=Date.now(),m.status=1,m.timing.start+=e-m.timing.paused,m.container.el.classList.remove("paused"),m.buttons.controls.classList.remove("paused"),m.els.page.classList.add("gameplay"),setTimeout(d,m.timing.interval)}var e}function g(e){var t="00000"+e;return t.substr(t.length-5)}function v(){m.score.board.h=m.score.board.el.offsetHeight,m.score.board.y=m.score.board.el.getBoundingClientRect().top,m.container.el.style.height="calc( 100vh - "+m.score.board.h+"px)",m.container.x=m.container.el.offsetWidth,m.container.y=m.container.el.offsetHeight}function f(){var e,t;window.pageYOffset>m.score.board.y-m.container.y&&0==m.status&&(m.score.board.el.classList.add("fixed"),m.status=4,e=4,m.countdown.classList.add("visible"),(t=function(){e--,0<(m.countdown.innerHTML=e)?setTimeout(t,1e3):n()})())}function y(e,t,n,a){var s;s=0,m.timing.timers[e]=window.setInterval(function(){t(),++s===a&&window.clearInterval(m.timing.timers[e])},n)}function M(){var e;return""==(e=function(e){var t,n,a,s;for(t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(s=n[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}("uri-space-invaders-high-score"))?(a(0),0):e}function a(e){var t,n,a,s,r;t="uri-space-invaders-high-score",n=e,a=365,(s=new Date).setTime(s.getTime()+24*a*60*60*1e3),r="expires="+s.toUTCString(),document.cookie=t+"="+n+";"+r+";path=/"}window.addEventListener("load",function(){var e;e=URIMODERN.path.theme+"/features/2018/space-invaders/",(m={unit:16,status:0,pointcap:50,n:0,els:{page:document.getElementById("page"),habitat:document.getElementById("habitat-creatures")},story:{h:document.getElementById("story").offsetHeight,top:document.getElementById("story").getBoundingClientRect().top},buttons:{},creatures:{},types:{tunicate1:"tunicate-1",tunicate2:"tunicate-2",seaweed1:"seaweed-1",seaweed2:"seaweed-2",crab:"crab"},container:{},endscreen:{},score:{points:0,spawned:0,removed:0,types:{},high:M(),board:{wrapper:document.getElementById("scoreboard-wrapper")}},timing:{init:2e3,duration:6e4,timers:{}},audio:{bounce:new Audio(e+"mp3/bounce.mp3"),elevate:new Audio(e+"mp3/elevate.mp3"),shoot:new Audio(e+"mp3/shoot.mp3"),end:new Audio(e+"mp3/end.mp3"),menu:new Audio(e+"mp3/menu.mp3")}}).game=document.createElement("div"),m.game.id="game",m.game.appendChild(function(){var e,t,n,a,s,r;for(s in m.endscreen.el=document.createElement("div"),m.endscreen.el.id="endscreen",m.endscreen.el.className="modal",m.endscreen.el.innerHTML="<h1>Game <br> Over</h1>",(t=document.createElement("div")).id="new-high-score",t.innerHTML="New High Score",m.endscreen.el.appendChild(t),(e=document.createElement("div")).id="game-stats",m.endscreen.stats={},m.types)r=m.types[s],(n=document.createElement("div")).className="stat-wrapper",(a=document.createElement("span")).className="stat-creature "+r,n.appendChild(a),m.endscreen.stats[r]=document.createElement("span"),m.endscreen.stats[r].className="stat-label",m.endscreen.stats[r].innerHTML=0,n.appendChild(m.endscreen.stats[r]),e.appendChild(n);return m.endscreen.el.appendChild(e),m.buttons.reset=document.createElement("div"),m.buttons.reset.id="reset-game",m.buttons.reset.className="retro-button",m.buttons.reset.innerHTML="play again",m.endscreen.el.appendChild(m.buttons.reset),(n=document.createElement("div")).id="remove-game",n.innerHTML="or, just read the story",n.addEventListener("click",l,!1),m.endscreen.el.appendChild(n),m.endscreen.el}()),m.game.appendChild((m.countdown=document.createElement("div"),m.countdown.id="countdown",m.countdown.className="modal",m.countdown.innerHTML=3,m.countdown)),m.game.appendChild((m.container.el=document.createElement("div"),m.container.el.id="creature-container",m.container.el)),m.game.appendChild((m.bubbles=document.createElement("div"),m.bubbles.id="bubbles-container",m.bubbles)),m.score.board.wrapper.appendChild((m.buttons.controls=document.createElement("div"),m.buttons.controls.id="controls",m.buttons.pause=document.createElement("div"),m.buttons.pause.id="pause-game",m.buttons.pause.innerHTML="pause",m.buttons.controls.appendChild(m.buttons.pause),m.buttons.resume=document.createElement("div"),m.buttons.resume.id="resume-game",m.buttons.resume.innerHTML="resume",m.buttons.controls.appendChild(m.buttons.resume),(r=document.createElement("div")).id="scores",(o=document.createElement("div")).id="points",o.innerHTML='<div class="label">score</div>',m.score.board.points=document.createElement("div"),m.score.board.points.className="score",m.score.board.points.innerHTML=g(m.score.points),o.appendChild(m.score.board.points),r.appendChild(o),(i=document.createElement("div")).id="high",i.innerHTML='<div class="label">high</div>',m.score.board.high=document.createElement("div"),m.score.board.high.className="score",m.score.board.high.innerHTML=g(m.score.high),i.appendChild(m.score.board.high),r.appendChild(i),(d=document.createElement("div")).id="progress",m.progress=document.createElement("div"),m.progress.id="progress-bar",d.appendChild(m.progress),(c=document.createElement("div")).id="progress-label",c.innerHTML="Complete Invasion! --\x3e",d.appendChild(c),m.score.board.el=document.createElement("div"),m.score.board.el.id="scoreboard",m.score.board.el.appendChild(m.buttons.controls),m.score.board.el.appendChild(r),m.score.board.el.appendChild(d),m.score.board.el)),document.getElementById("main").appendChild(m.game),m.score.board.h=m.score.board.el.offsetHeight,m.score.board.y=m.score.board.el.getBoundingClientRect().top,m.score.board.parent=m.score.board.wrapper.parentElement,m.container.el.style.height="calc( 100vh - "+m.score.board.h+"px)",m.container.x=m.container.el.offsetWidth,m.container.y=m.container.el.offsetHeight,m.buttons.reset.addEventListener("click",function(){b(m.audio.menu)},!1),m.buttons.pause.addEventListener("click",function(){1==m.status&&b(m.audio.menu)},!1),m.buttons.resume.addEventListener("click",function(){3==m.status&&b(m.audio.menu)},!1),m.els.habitat.innerHTML="",t=document.createElement("div"),m.els.habitat.appendChild(t),y("populateCreatureBox",function(){n=h(),a=m.unit*Math.floor(48*Math.random()+1),s=Math.floor(10*Math.random()+1),n.div.style="left:"+a+"px; z-index:"+s,t.appendChild(n.div)},50,15),u(),window.addEventListener("resize",v,!1),window.addEventListener("scroll",f,!1);var t,n,a,s;var r,o,i,d,c},!1)}();
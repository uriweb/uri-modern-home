/* built */!function(){"use strict";var p;function n(){p.countdown.classList.remove("visible"),p.els.page.classList.add("gameplay"),1!=p.status&&(p.status=1,m(),M("initialCreatures",c,50,10),p.timing.start=Date.now(),setTimeout(d,p.timing.init))}function d(){var e,t,n,a,s,o,r,i;1==p.status&&(e=Date.now()-p.timing.start,a=0,s=p.timing.duration,o=e,r=Math.abs(s)-Math.abs(a),i=(Math.abs(o)-Math.abs(a))/r,t=Math.pow(i,2),n=Math.max(120,Math.min(380,p.container.x*p.container.y/1e6*300)),p.timing.interval=Math.max(n,p.timing.init-p.timing.init*t),c(),p.n++,setTimeout(d,p.timing.interval))}function m(){var e,t;1==p.status&&(p.score.board.points.innerHTML=v(p.score.points),p.score.points>=p.score.high&&(p.score.board.high.innerHTML=v(p.score.points)),e=p.score.spawned-p.score.removed,t=100/p.pointcap*e,p.progress.style.width=t+"%",t<50?p.progress.classList.remove("alert"):t<75?(p.progress.classList.remove("warning"),p.progress.classList.add("alert")):t<90?(p.progress.classList.remove("alert","danger"),p.progress.classList.add("warning")):t<100&&(p.progress.classList.remove("warning"),p.progress.classList.add("danger")),p.pointcap==e&&function(){var e,t;for(e in p.status=2,p.endscreen.stats)t=0,null!=p.score.types[e]&&(t=p.score.types[e]),p.endscreen.stats[e].innerHTML=t;p.audio.end.play(),p.container.el.classList.add("endgame"),p.endscreen.el.classList.add("visible"),p.score.points>w()&&(a(p.score.points),p.endscreen.el.classList.add("new-high")),M("endGame",c,20,Math.floor(Math.max(200,Math.min(600,p.container.x*p.container.y/1e6*400))))}())}function h(){var e,t,n,a={};switch(t=Math.floor(1e3*Math.random()),n=Math.floor(3*Math.random()+1),t<300?a.type=p.types.tunicate1:t<600?a.type=p.types.tunicate2:t<750?a.type=p.types.seaweed1:t<900?a.type=p.types.seaweed2:t<1e3&&(a.type=p.types.crab),n){case 1:e="slow";break;case 2:e="fast";break;default:e=""}return a.div=document.createElement("div"),a.div.className="creature "+a.type+" "+e,a}function c(){var e,t,n,a,s,o,r,i,d,c,l,u;e=h(),c=e.type,l=p.container.el.querySelectorAll("."+c+":not(.destroyed)"),u=Math.floor(Math.random()*l.length),t=0<l.length?l[u].parentNode.getAttribute("id"):null,d="c_"+Math.random().toString(36).substr(2,9),a={left:0,right:p.container.x-128,top:Math.max(128,p.container.y-16*p.n),bottom:p.container.y-p.score.board.h},(n=Math.floor(1e3*Math.random()))<700&&null!=t&&"crab"!=e.type&&0<p.n?(o=Math.min(a.right,Math.max(128,p.creatures[t].x+p.unit*Math.floor(17*Math.random()-8))),r=Math.min(a.bottom,Math.max(128,p.creatures[t].y+p.unit*Math.floor(17*Math.random()-8)))):(o=Math.max(a.left,p.unit*Math.floor(Math.random()*(a.right/p.unit))),r=Math.max(a.top,p.unit*Math.floor(Math.random()*(a.bottom/p.unit)))),i=Math.floor(10*Math.random()+1),(s=document.createElement("div")).id=d,s.className="creature-wrapper",n<500&&s.classList.add("flipped"),s.style="top:"+r+"px; left:"+o+"px; z-index:"+i,s.appendChild(e.div),1==p.status&&s.addEventListener("click",function(e){var t,n;switch((t=p.creatures[e]).el.classList.add("destroyed"),t.status=0,null==p.score.types[t.type]?p.score.types[t.type]=1:p.score.types[t.type]++,setTimeout(function(){p.container.el.removeChild(t.el)},5e3),t.type){case p.types.crab:b(p.audio.elevate),n=30;break;case p.types.tunicate1:b(p.audio.bounce),n=10;break;case p.types.tunicate2:b(p.audio.bounce),n=30;break;case p.types.seaweed1:case p.types.seaweed2:b(p.audio.shoot),n=20;break;default:b(p.audio.shoot),n=10}p.score.removed++,p.score.points+=n,m()}.bind(null,d),!1),p.creatures[d]={el:s,x:o,y:r,type:e.type,status:1},p.container.el.appendChild(s),p.score.spawned++,m()}function u(){var e,t,n,a,s;e=Math.floor(7001*Math.random()+1e3),t="b_"+Math.random().toString(36).substr(2,9),n=p.unit*Math.floor(Math.random()*(p.container.x/p.unit)),a=p.unit*Math.floor(Math.random()*(p.container.y/p.unit)),(s=document.createElement("div")).id=t,s.className="bubbles bubbles-1",s.style="top:"+a+"px; left:"+n+"px",p.bubbles.appendChild(s),setTimeout(function(){p.bubbles.removeChild(s)},5e3),setTimeout(u,e)}function b(e){e.paused?e.play():e.currentTime=0}function g(){switch(p.status){case 0:n();break;case 1:p.status=3,p.timing.paused=Date.now(),p.container.el.classList.add("paused"),p.buttons.controls.classList.add("paused"),p.els.page.classList.remove("gameplay");break;case 2:window.clearInterval(p.timing.timers.endGame),p.container.el.innerHTML="",p.container.el.classList.remove("endgame"),p.endscreen.el.classList.remove("visible","new-high"),p.progress.className="",p.score.points=0,p.score.high=w(),p.score.spawned=0,p.score.removed=0,p.score.types={},p.n=0,p.score.board.high.innerHTML=v(p.score.high),n();break;case 3:e=Date.now(),p.status=1,p.timing.start+=e-p.timing.paused,p.container.el.classList.remove("paused"),p.buttons.controls.classList.remove("paused"),p.els.page.classList.add("gameplay"),setTimeout(d,p.timing.interval)}var e}function v(e){var t="00000"+e;return t.substr(t.length-5)}function f(){p.score.board.h=p.score.board.el.offsetHeight,p.score.board.y=p.score.board.el.getBoundingClientRect().top,p.container.el.style.height="calc( 100vh - "+p.score.board.h+"px)",p.container.x=p.container.el.offsetWidth,p.container.y=p.container.el.offsetHeight}function y(){var e,t;window.pageYOffset>p.score.board.y-p.container.y&&0==p.status&&(p.score.board.el.classList.add("fixed"),p.status=4,e=4,p.countdown.classList.add("visible"),(t=function(){e--,0<(p.countdown.innerHTML=e)?setTimeout(t,1e3):n()})())}function M(e,t,n,a){var s;s=0,p.timing.timers[e]=window.setInterval(function(){t(),++s===a&&window.clearInterval(p.timing.timers[e])},n)}function w(){var e;return""==(e=function(e){var t,n,a,s;for(t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(s=n[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}("uri-space-invaders-high-score"))?(a(0),0):e}function a(e){var t,n,a,s,o;t="uri-space-invaders-high-score",n=e,a=365,(s=new Date).setTime(s.getTime()+24*a*60*60*1e3),o="expires="+s.toUTCString(),document.cookie=t+"="+n+";"+o+";path=/"}window.addEventListener("load",function(){var e,t;e=URIMODERN.path.theme+"/features/2018/space-invaders/",p={unit:16,status:0,pointcap:50,n:0,els:{page:document.getElementById("page"),habitat:document.getElementById("habitat-creatures")},story:{h:document.getElementById("story").offsetHeight,top:document.getElementById("story").getBoundingClientRect().top},buttons:{},creatures:{},types:{tunicate1:"tunicate-1",tunicate2:"tunicate-2",seaweed1:"seaweed-1",seaweed2:"seaweed-2",crab:"crab"},container:{},endscreen:{},score:{points:0,spawned:0,removed:0,types:{},high:w(),board:{wrapper:document.getElementById("scoreboard-wrapper")}},timing:{init:2e3,duration:6e4,timers:{}},audio:{bounce:new Audio(e+"mp3/bounce.mp3"),elevate:new Audio(e+"mp3/elevate.mp3"),shoot:new Audio(e+"mp3/shoot.mp3"),end:new Audio(e+"mp3/end.mp3"),menu:new Audio(e+"mp3/menu.mp3")}},(t=document.createElement("div")).id="game",t.appendChild(function(){var e,t,n,a,s,o;for(s in p.endscreen.el=document.createElement("div"),p.endscreen.el.id="endscreen",p.endscreen.el.className="modal",p.endscreen.el.innerHTML="<h1>Game <br> Over</h1>",(t=document.createElement("div")).id="new-high-score",t.innerHTML="New High Score",p.endscreen.el.appendChild(t),(e=document.createElement("div")).id="game-stats",p.endscreen.stats={},p.types)o=p.types[s],(n=document.createElement("div")).className="stat-wrapper",(a=document.createElement("span")).className="stat-creature "+o,n.appendChild(a),p.endscreen.stats[o]=document.createElement("span"),p.endscreen.stats[o].className="stat-label",p.endscreen.stats[o].innerHTML=0,n.appendChild(p.endscreen.stats[o]),e.appendChild(n);return p.endscreen.el.appendChild(e),p.buttons.reset=document.createElement("div"),p.buttons.reset.id="reset-game",p.buttons.reset.className="retro-button",p.buttons.reset.innerHTML="play again",p.endscreen.el.appendChild(p.buttons.reset),p.endscreen.el}()),t.appendChild((p.countdown=document.createElement("div"),p.countdown.id="countdown",p.countdown.className="modal",p.countdown.innerHTML=3,p.countdown)),t.appendChild((p.container.el=document.createElement("div"),p.container.el.id="creature-container",p.container.el)),t.appendChild((p.bubbles=document.createElement("div"),p.bubbles.id="bubbles-container",p.bubbles)),p.score.board.wrapper.appendChild((p.buttons.controls=document.createElement("div"),p.buttons.controls.id="controls",p.buttons.pause=document.createElement("div"),p.buttons.pause.id="pause-game",p.buttons.pause.innerHTML="pause",p.buttons.controls.appendChild(p.buttons.pause),p.buttons.resume=document.createElement("div"),p.buttons.resume.id="resume-game",p.buttons.resume.innerHTML="resume",p.buttons.controls.appendChild(p.buttons.resume),(r=document.createElement("div")).id="scores",(i=document.createElement("div")).id="points",i.innerHTML='<div class="label">score</div>',p.score.board.points=document.createElement("div"),p.score.board.points.className="score",p.score.board.points.innerHTML=v(p.score.points),i.appendChild(p.score.board.points),r.appendChild(i),(d=document.createElement("div")).id="high",d.innerHTML='<div class="label">high</div>',p.score.board.high=document.createElement("div"),p.score.board.high.className="score",p.score.board.high.innerHTML=v(p.score.high),d.appendChild(p.score.board.high),r.appendChild(d),(c=document.createElement("div")).id="progress",p.progress=document.createElement("div"),p.progress.id="progress-bar",c.appendChild(p.progress),(l=document.createElement("div")).id="progress-label",l.innerHTML="Complete Invasion! --\x3e",c.appendChild(l),p.score.board.el=document.createElement("div"),p.score.board.el.id="scoreboard",p.score.board.el.appendChild(p.buttons.controls),p.score.board.el.appendChild(r),p.score.board.el.appendChild(c),p.score.board.el)),document.getElementById("main").appendChild(t),p.score.board.h=p.score.board.el.offsetHeight,p.score.board.y=p.score.board.el.getBoundingClientRect().top,p.container.el.style.height="calc( 100vh - "+p.score.board.h+"px)",p.container.x=p.container.el.offsetWidth,p.container.y=p.container.el.offsetHeight,p.buttons.reset.addEventListener("click",function(){b(p.audio.menu)},!1),p.buttons.pause.addEventListener("click",function(){1==p.status&&b(p.audio.menu)},!1),p.buttons.resume.addEventListener("click",function(){3==p.status&&b(p.audio.menu)},!1),p.els.habitat.innerHTML="",n=document.createElement("div"),p.els.habitat.appendChild(n),M("populateCreatureBox",function(){a=h(),s=p.unit*Math.floor(48*Math.random()+1),o=Math.floor(10*Math.random()+1),a.div.style="left:"+s+"px; z-index:"+o,n.appendChild(a.div)},50,15),u(),p.audio.menu.onended=g,window.addEventListener("resize",f,!1),window.addEventListener("scroll",y,!1);var n,a,s,o;var r,i,d,c,l},!1)}();